USE [one-c-sharp];

IF NOT EXISTS(SELECT 1 FROM sys.tables AS t
              INNER JOIN sys.schemas AS s
			  ON t.schema_id = s.schema_id
			  WHERE s.name = N'ocs' AND t.name = N'entities' AND t.type = N'U')
BEGIN
	CREATE TABLE [ocs].[entities]
	(
		[key] [uniqueidentifier] NOT NULL,
		[version] [rowversion] NOT NULL,
		[name] [nvarchar](100) NOT NULL,
		[alias] [nvarchar](128) NOT NULL,
		[code] [int] NOT NULL,
		[table] [uniqueidentifier] NOT NULL,
		[namespace] [uniqueidentifier] NOT NULL,
		[owner] [uniqueidentifier] NOT NULL, -- nesting
		[parent] [uniqueidentifier] NOT NULL, -- inheritance
		[is_sealed] [bit] NOT NULL,
		[is_abstract] [bit] NOT NULL,
		CONSTRAINT [pk_entities] PRIMARY KEY CLUSTERED ([key] ASC)
	)
END

IF NOT EXISTS(SELECT 1 FROM sys.indexes WHERE name = N'nnx_entities_namespace' AND object_id = OBJECT_ID(N'ocs.entities'))
BEGIN
	CREATE NONCLUSTERED INDEX nnx_entities_namespace ON [ocs].[entities] ([namespace]);
END

IF NOT EXISTS(SELECT 1 FROM [ocs].[entities] WHERE [key] = CAST(0x00000000000000000000000000000000 AS uniqueidentifier))
BEGIN
	INSERT [ocs].[entities] ([key], [code], [name], [namespace], [owner], [parent], [alias], [is_abstract], [is_sealed], [table])
	VALUES
	(0x00000000000000000000000000000000,   0, N'Empty',    0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFFF,  -1, N'Object',   0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFFE,  -2, N'DBNull',   0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFFD,  -3, N'Boolean',  0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFFC,  -4, N'Char',     0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFFB,  -5, N'SByte',    0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFFA,  -6, N'Byte',     0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFF9,  -7, N'Int16',    0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFF8,  -8, N'UInt16',   0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFF7,  -9, N'Int32',    0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFF6, -10, N'UInt32',   0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFF5, -11, N'Int64',    0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFF4, -12, N'UInt64',   0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFF3, -13, N'Single',   0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFF2, -14, N'Double',   0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFF1, -15, N'Decimal',  0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFF0, -16, N'DateTime', 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFEF, -17, N'GUID',     0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFEE, -18, N'String',   0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFED, -19, N'Binary',   0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFEC, -20, N'Array',    0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000),
	(0x000000000000000000000000FFFFFFEB, -21, N'ObjRef',   0x00000000000000000000000000000000, 0x00000000000000000000000000000000, 0x00000000000000000000000000000000, N'', 0x00, 0x00, 0x00000000000000000000000000000000);
END